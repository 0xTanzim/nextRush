name: 🛠️ Local Development Workflow

on:
  push:
    branches: [ feat/*, dev/*, fix/* ]
  workflow_dispatch:

jobs:
  # 🚀 Quick Development Checks (Local-friendly)
  dev-check-local:
    name: 🚀 Local Dev Check
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4

      - name: 📦 Setup Node.js and pnpm manually
        run: |
          # Install Node.js 20
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
          sudo apt-get install -y nodejs

          # Install pnpm
          npm install -g pnpm@8

          # Verify installations
          node --version
          npm --version
          pnpm --version

      - name: 📦 Install Dependencies
        run: pnpm install --frozen-lockfile

      - name: 🏗️ Build Check
        run: pnpm build

      - name: 🧪 Quick Test
        run: pnpm test

      - name: 🔍 Lint Check
        run: pnpm lint || echo "⚠️ Lint issues found but continuing..."

      - name: ⚡ Performance Check
        run: |
          cd benchmarks
          pnpm install
          echo "✅ Benchmark dependencies installed"

  # 🔍 Simple Build Test
  build-test-local:
    name: 🏗️ Local Build Test
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4

      - name: 📦 Setup Environment
        run: |
          # Install Node.js 20
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
          sudo apt-get install -y nodejs
          npm install -g pnpm@8

      - name: 📦 Install and Build
        run: |
          pnpm install --frozen-lockfile
          pnpm build

      - name: ✅ Verify Build Output
        run: |
          ls -la dist/
          echo "✅ Build artifacts created successfully!"

      - name: 🧪 Test Build Output
        run: |
          node -e "console.log('Testing built package...'); const pkg = require('./dist/index.js'); console.log('✅ Package loads successfully!');"
